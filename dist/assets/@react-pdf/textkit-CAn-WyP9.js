import{c as S,i as L,r as q,l as O,h as bt,j as xt,k as N}from"./fns-DvmUkUUA.js";import{b as T}from"../bidi-js-DLACMwmw.js";import{$ as Ot}from"../unicode-properties-CQ3Ws5kP.js";import{h as It,p as kt}from"../hyphen-DM2ckLBc.js";const wt=t=>{let s=0,n="";const e=[];return t.forEach(r=>{n+=r.string,e.push({...r,start:s,end:s+r.string.length,attributes:r.attributes||{}}),s+=r.string.length}),{string:n,runs:e}},vt=t=>[t],Lt=(t={},s={})=>n=>{const e=[],r=[],i=s.hyphenationCallback||t.wordHyphenation?.()||vt;for(let l=0;l<n.runs.length;l+=1){let c="";const h=n.runs[l],a=n.string.slice(h.start,h.end).split(/([ ]+)/g).filter(Boolean);for(let u=0;u<a.length;u+=1){const f=a[u],p=i(f);e.push(...p),c+=p.join("")}r.push({...h,string:c})}return{...wt(r),syllables:e}},Pt=t=>Object.assign({},t),Q=(t,s)=>{const n=Object.assign({},t,{height:s}),e=Object.assign({},t,{y:t.y+s,height:t.height-s});return[n,e]},Rt=(t,s)=>{const[,n]=Q(s,t);return n},jt=t=>t.reduce((s,n)=>s+n.box.height,0),Et=t=>{const s=t.attributes||{},n=s.fontSize||12,e=s.font,r=typeof e=="string"?null:e?.[0]?.unitsPerEm;return r?n/r:0},w=t=>t.attributes?.scale||Et(t),_=(t,s)=>{if(!s)return 0;const n=s.glyphIndices||[],e=n[t];return n.slice(0,t).filter(r=>r===e).length},H=t=>t.attributes?.font?.[0]||null,G=(t,s,n,e)=>{if(!e)return[];if(t===s)return[];if(t===0&&s===e.codePoints.length)return[e];const r=e.codePoints.slice(t,s),i=String.fromCodePoint(...r);return n?n.layout(i,void 0,void 0,void 0,"ltr").glyphs:[e]},E=(t,s)=>{const n=s?.glyphIndices?.[t];return L(n)?t:n},V=t=>{const s=t[0];return t.map(n=>n-s)},v=(t,s,n)=>{const e=w(n),r=H(n),i=E(t,n),o=E(s,n),l=n.glyphs?.[i],c=n.glyphs?.[o],h=_(t,n),a=h>0?G(h,1/0,r,l):[],u=_(s,n),f=G(0,u,r,c),p=i+Math.min(1,h),m=(n.glyphs||[]).slice(p,o),d=mt=>({xAdvance:mt.advanceWidth*e,yAdvance:0,xOffset:0,yOffset:0}),b=a.map(d),y=(n.positions||[]).slice(p,o),x=f.map(d);return Object.assign({},n,{start:n.start+t,end:Math.min(n.end,n.start+s),glyphIndices:V((n.glyphIndices||[]).slice(t,s)),glyphs:[a,m,f].flat(),positions:[b,y,x].flat()})},M=(t,s)=>s?s.findIndex(n=>n.start<=t&&t<n.end):-1,tt=(t,s,n)=>{const e=M(t,n),r=Math.max(M(s-1,n),e);return n.slice(e,r+1)},At=(t,s)=>{const n=s.start-t,e=s.end-t;return Object.assign({},s,{start:n,end:e})},Ct=(t,s,n)=>{const e=i=>v(t-i.start,s-i.start,i),r=i=>v(0,s-i.start,i);return n.map((i,o)=>{let l=i;const c=o===0,h=!c&&o===n.length-1;return c&&(l=e(i)),h&&(l=r(i)),At(t,l)})},I=(t,s,n)=>{if(n.string.length===0)return n;const e=n.string.slice(t,s),r=tt(t,s,n.runs),i=Ct(t,s,r);return Object.assign({},n,{string:e,runs:i})},Ft=t=>t.search(/\S/g),St=t=>{const s=t.match(/\S/g);return s?t.lastIndexOf(s[s.length-1]):-1},Mt=t=>{const s=Ft(t.string),n=St(t.string);return I(s,n+1,t)},Tt=()=>({start:0,end:0,glyphIndices:[],glyphs:[],positions:[],attributes:{}}),st=t=>typeof t=="number",Ht=(t,s)=>{const n=O(s),e=L(n)?0:n+1,r=Array(t).fill(e);return s.concat(r)},nt=(t,s)=>typeof s=="string"?null:s&&t?s.glyphForCodePoint(t):null,$t=(t,s)=>{const n=t.codePoints?.length||0,e=s.end+n,r=s.glyphs.concat(t),i=Ht(n,s.glyphIndices);if(!s.positions)return Object.assign({},s,{end:e,glyphs:r,glyphIndices:i});const o=s.positions.concat({xAdvance:t.advanceWidth*w(s),yAdvance:0,xOffset:0,yOffset:0});return Object.assign({},s,{end:e,glyphs:r,glyphIndices:i,positions:o})},et=(t,s)=>{if(!t)return s;const n=H(s),e=st(t)?nt(t,n):t;return $t(e,s)},rt=t=>String.fromCodePoint(...t||[]),it=(t,s)=>{const n=typeof t=="number"?[t]:t?.codePoints,e=rt(n||[]),r=s.string+e,i=s.runs.slice(0,-1),o=O(s.runs)||Tt(),l=i.concat(et(t,o));return Object.assign({},s,{string:r,runs:l})},ot=8230,Wt=String.fromCharCode(ot),zt=t=>{if(!t.encode)return ot;const[s]=t.encode(Wt);return parseInt(s[0],16)},B=t=>{const s=O(t)?.runs||[],n=O(s)?.attributes?.font[0];if(n){const e=t.length-1,r=zt(n),i=n.glyphForCodePoint(r),o=it(i,Mt(t[e]));return Object.assign([],t,{[e]:o})}return t},ct=(t,s)=>{const n=Object.assign({},s.attributes);return delete n[t],Object.assign({},s,{attributes:n})},A=t=>{const{font:s,attachment:n}=t.attributes,e=n?.height||0,r=typeof s=="string"?0:s?.[0]?.ascent||0;return Math.max(e,r*w(t))},lt=t=>{const s=t.attributes?.font,n=typeof s=="string"?0:s?.[0]?.descent||0;return w(t)*n},Nt=t=>{const s=t.attributes?.font;return(typeof s=="string"?0:s?.[0]?.lineGap||0)*w(t)},at=t=>t.attributes?.lineHeight||Nt(t)+A(t)-lt(t),ht=t=>{const s=(n,e)=>Math.max(n,at(e));return t.runs.reduce(s,0)},_t=(t,s)=>{const n=Math.max(t.x,s.x),e=Math.min(t.x+t.width,s.x+s.width),r=Math.max(t.y,s.y),i=Math.min(t.y+t.height,s.y+s.height);return e>=n&&i>=r},Gt=(t,s)=>{if(!_t(s,t))return[t];const n=s.x,e=s.x+s.width,r=t.x,i=t.x+t.width,o=Object.assign({},t,{width:n-r}),l=Object.assign({},t,{x:e,width:i-e});return[o,l].filter(c=>c.width>0)},Bt=(t,s)=>{let n=[t];for(let e=0;e<s.length;e+=1){const r=s[e];n=n.reduce((i,o)=>{const l=Gt(o,r);return i.concat(l)},[])}return n},Dt=(t,s)=>{const{excludeRects:n,...e}=t;if(!n)return[e];const r=[],i=Math.max(...n.map(l=>l.y+l.height));let o=e;for(;o.y<i;){const[l,c]=Q(o,s),h=Bt(l,n);o=c,r.push(...h)}return[...r,o]},Yt="￼",Kt=t=>{if(!!t.string.includes(Yt))return t;const n=t.runs.map(e=>ct("attachment",e));return Object.assign({},t,{runs:n})},Ut=(t,s,n)=>{let e=t.shift(),r=e.y;return s.map((i,o)=>{const l=o===0?n:0,c=i.runs?.[0]?.attributes||{},h=Math.max(ht(i),c.lineHeight);r+h>e.y+e.height&&t.length>0&&(e=t.shift(),r=e.y);const a={string:i.string,runs:i.runs,box:{x:e.x+l,y:r,width:e.width-l,height:h}};return r+=h,Kt(a)})},Xt=(t,s={})=>(n,e)=>{const r=ht(e),i=e.runs?.[0]?.attributes?.indent||0,o=Dt(n,r),l=o.map(h=>h.width);l.unshift(l[0]-i);const c=t.linebreaker(s)(e,l);return Ut(o,c,i)},Jt=(t,s)=>{const n=[];let e=0;for(let r=0;r<s.length;r+=1){const i=s[r];if(e+=i.box.height,e<t)n.push(i);else break}return n},Zt=(t,s,n)=>e=>{const r=[],i=[...e],o=Xt(t,s),l=L(n.maxLines)?1/0:n.maxLines,c=n.truncateMode==="ellipsis";let h=l,a=Pt(n),u=i.shift();for(;h>0&&u;){const f=o(a,u),p=f.slice(0,h),m=jt(p),d=c&&f.length!==p.length;if(h-=p.length,a.height>=m)r.push(d?B(p):p),a=Rt(m,a),u=i.shift();else{r.push(B(Jt(a.height,p)));break}}return r},qt=t=>{const{runs:s}=t;return s.length===0?0:s[0].start},Qt=t=>{const{runs:s}=t;return s.length===0?0:O(s).end},ut=t=>Qt(t)-qt(t),D=T(),Vt=t=>t.reduce((s,n)=>{const e=n.end-n.start,r=q(n.attributes.bidiLevel,e);return s.concat(r)},[]),ts=(t,s)=>{const n=[];for(let e=0;e<t.length;e+=1)n[e]=e;return s.forEach(([e,r])=>{const i=n.slice(e,r+1);for(let o=i.length-1;o>=0;o-=1)n[r-o]=i[o]}),n},Y=(t,s,n)=>{for(let e=0;e<t.length;e+=1){const r=t[e],i=r.glyphIndices[n-r.start];if(n>=r.start&&n<r.end)return r[s][i]}throw new Error(`index ${n} out of range`)},ss=t=>{const s=Vt(t.runs),e=t.runs[0]?.attributes.direction==="rtl"?1:0,o={paragraphs:[{start:0,end:ut(t)-1,level:e}],levels:s},l=D.getReorderSegments(t.string,o);if(l.length===0)return t;const c=ts(t.string,l),h=D.getReorderedString(t.string,o),a=t.runs.map(u=>{const f=c.slice(u.start,u.end),p=[],m=[],d=new Set;for(let b=0;b<f.length;b+=1){const y=f[b],x=Y(t.runs,"glyphs",y);d.has(x.id)||(p.push(x),m.push(Y(t.runs,"positions",y)),x.isLigature&&d.add(x.id))}return{...u,glyphs:p,positions:m}});return{box:t.box,runs:a,string:h}},ns=t=>t.map(ss),es=()=>t=>t.map(ns),rs=123,is=(t=[])=>t.reduce((s,n)=>{const e=n?.codePoints||[rs];if(s.length===0)return e.map(()=>0);const r=s[s.length-1],i=e.map(()=>r+1);return[...s,...i]},[]),os=t=>t.attributes?.characterSpacing||0,cs=(t,s)=>{const n=w(t),e=os(t);return s.map((r,i)=>{const l=i===s.length?0:e;return Object.assign({},r,{xAdvance:r.xAdvance*n+l,yAdvance:r.yAdvance*n,xOffset:r.xOffset*n,yOffset:r.yOffset*n})})},ls=t=>s=>{const{start:n,end:e,attributes:r={}}=s,{font:i}=r;if(!i)return{...s,glyphs:[],glyphIndices:[],positions:[]};const o=t.slice(n,e);if(typeof i=="string")throw new Error("Invalid font");const l=i[0].layout(o,void 0,void 0,void 0,"ltr"),c=cs(s,l.positions),h=is(l.glyphs);return{...s,positions:c,glyphIndices:h,glyphs:l.glyphs}},as=()=>t=>{const s=t.runs.map(ls(t.string));return Object.assign({},t,{runs:s})},hs=t=>{if(!t.positions)return t;const s=t.attributes?.font?.[0]?.unitsPerEm||0,n=(t.attributes?.yOffset||0)*s,e=t.positions.map(r=>Object.assign({},r,{yOffset:n}));return Object.assign({},t,{positions:e})},us=()=>t=>{const s=t.runs.map(hs);return Object.assign({},t,{runs:s})},fs=t=>t.sort((s,n)=>s.start-n.start||s.end-n.end),K=t=>t.start===t.end,ps=(t,s)=>t[1]-s[1]||t[3]-s[3],ds=t=>t.reduce((n,e,r)=>n.concat([["start",e.start,e.attributes,r],["end",e.end,e.attributes,r]]),[]).sort(ps),gs=t=>t.reduce((s,n)=>{const e=Object.assign({},s.attributes,n.attributes);return Object.assign({},n,{attributes:e})},{}),ys=t=>{const s=t.reduce((n,e)=>(n[e.start]||(n[e.start]=[]),n[e.start].push(e),n),[]);return Object.values(s)},ms=t=>ys(t).map(gs),bs=t=>{const s=[],n=ds(t);let e=-1,r={};const i=[];for(let o=0;o<n.length;o+=1){const[l,c,h]=n[o];if(e!==-1&&e<c&&s.push({start:e,end:c,attributes:r,glyphIndices:[],glyphs:[],positions:[]}),l==="start")i.push(h),r=Object.assign({},r,h);else{r={};for(let a=0;a<i.length;a+=1)i[a]===h?i.splice(a--,1):r=Object.assign({},r,i[a])}e=c}return s},xs=(t=[])=>{const s=ms(t.filter(e=>K(e))),n=bs(t.filter(e=>!K(e)));return fs(s.concat(n))},ft=()=>({string:"",runs:[]}),Os=t=>{const s=t.runs.map(n=>ct("font",n));return Object.assign({},t,{runs:s})},Is=t=>s=>{if(L(s))return ft();const{string:n}=s,{fontSubstitution:e,scriptItemizer:r,bidi:i}=t,{runs:o}=Os(s),{runs:l}=r()(s),{runs:c}=e()(s),{runs:h}=i()(s),a=h.concat(c).concat(l).concat(o);return{string:n,runs:xs(a)}},ks=()=>t=>{const s=[];let n=0,e=t.string.indexOf(`
`)+1;for(;e>0;)s.push(I(n,e,t)),n=e,e=t.string.indexOf(`
`,e)+1;return n===0?s.push(t):n<t.string.length&&s.push(I(n,ut(t),t)),s},pt=t=>t.reduce((s,n)=>s+(n.xAdvance||0),0),$=t=>pt(t.positions||[]),W=t=>{const s=(n,e)=>n+$(e);return t.runs.reduce(s,0)},ws=32,z=t=>(t?.codePoints||[]).includes(ws),vs=t=>{const s=t.glyphs||[],n=t.positions||[],e=s.findIndex(r=>!z(r));return n.slice(0,e)},Ls=t=>vs(t).reduce((n,e)=>n+(e.xAdvance||0),0),Ps=t=>{const s=t.runs||[];return Ls(s[0])},Rs=t=>{const s=N(t.glyphs||[]),n=N(t.positions||[]),e=s.findIndex(r=>!z(r));return n.slice(0,e)},js=t=>Rs(t).reduce((n,e)=>n+(e.xAdvance||0),0),Es=t=>{const s=t.runs||[];return js(O(s))},As=t=>v(0,t.end-t.start-1,t),Cs=t=>{const s=bt(t.string),n=xt(-1,As,t.runs);return Object.assign({},t,{string:s,runs:n})},Fs={center:.5,right:1},Ss=t=>O(t.string)===`
`?Cs(t):t,Ms=t=>Ps(t)+(t.overflowLeft||0),Ts=t=>Es(t)+(t.overflowRight||0),Hs=t=>{const s=Ms(t),n=Ts(t),e=t.box.x-s,r=t.box.width+s+n,i=Object.assign({},t.box,{x:e,width:r});return Object.assign({},t,{box:i,overflowLeft:s,overflowRight:n})},$s=(t,s,n)=>e=>{const r=W(e),i=Fs[n]||0,o=Math.max(0,e.box.width-r),l=n==="justify"||r>e.box.width,c=e.box.x+o*i,h=Object.assign({},e.box,{x:c}),a=Object.assign({},e,{box:h});return l?t.justification(s)(a):a},Ws=t=>{let s=0,n=0,e=0,r=0;const i=t.runs.map(o=>{const l=at(o),c=A(o),h=lt(o),a=$(o);return e=Math.max(e,l),s=Math.max(s,c),n=Math.max(n,h),r+=a,Object.assign({},o,{height:l,ascent:c,descent:h,xAdvance:a})});return Object.assign({},t,{runs:i,height:e,ascent:s,descent:n,xAdvance:r})},zs=(t,s)=>(n,e,r)=>{const i=e===r.length-1,o=n.runs?.[0]?.attributes||{},l=i?o.alignLastLine:o.align;return S(Ws,t.textDecoration(),$s(t,s,l),Hs,Ss)(n)},Ns=(t,s)=>n=>{const e=zs(t,s);return n.map(r=>r.map(e))},_s=65532,Gs=t=>t.codePoints.includes(_s),Bs=t=>{if(!t.positions)return t;const s=t.glyphs||[],n=t.attributes?.attachment;if(!n)return t;const e=t.positions.map((r,i)=>{const o=s[i];return n.width&&Gs(o)?Object.assign({},r,{xAdvance:n.width}):Object.assign({},r)});return Object.assign({},t,{positions:e})},Ds=()=>t=>{const s=t.runs.map(Bs);return Object.assign({},t,{runs:s})},Ys=t=>({align:t.align||(t.direction==="rtl"?"right":"left"),alignLastLine:t.alignLastLine||(t.align==="justify"?"left":t.align||"left"),attachment:t.attachment||null,backgroundColor:t.backgroundColor||null,bullet:t.bullet||null,characterSpacing:t.characterSpacing||0,color:t.color||"black",direction:t.direction||"ltr",features:t.features||[],fill:t.fill!==!1,font:t.font||[],fontSize:t.fontSize||12,hangingPunctuation:t.hangingPunctuation||!1,hyphenationFactor:t.hyphenationFactor||0,indent:t.indent||0,justificationFactor:t.justificationFactor||1,lineHeight:t.lineHeight||null,lineSpacing:t.lineSpacing||0,link:t.link||null,marginLeft:t.marginLeft||t.margin||0,marginRight:t.marginRight||t.margin||0,opacity:t.opacity,paddingTop:t.paddingTop||t.padding||0,paragraphSpacing:t.paragraphSpacing||0,script:t.script||null,shrinkFactor:t.shrinkFactor||0,strike:t.strike||!1,strikeColor:t.strikeColor||t.color||"black",strikeStyle:t.strikeStyle||"solid",stroke:t.stroke||!1,underline:t.underline||!1,underlineColor:t.underlineColor||t.color||"black",underlineStyle:t.underlineStyle||"solid",verticalAlign:t.verticalAlign||null,wordSpacing:t.wordSpacing||0,yOffset:t.yOffset||0}),Ks=t=>{const s=Ys(t.attributes);return Object.assign({},t,{attributes:s})},Us=()=>t=>{const s=t.string||"",n=(t.runs||[]).map(Ks);return{string:s,runs:n}},Xs=()=>t=>(t.runs.forEach(s=>{const{attributes:n}=s,{verticalAlign:e}=n;e==="sub"?n.yOffset=-.2:e==="super"&&(n.yOffset=.4)}),t),Js=T(),Zs=t=>t.reduce((s,n)=>{const e=n.end-n.start,r=q(n.attributes.bidiLevel,e);return s.concat(r)},[]),qs=()=>t=>{const s=Zs(t.runs);let n="";return t.string.split("").forEach((r,i)=>{const l=s[i]%2===1?Js.getMirroredCharacter(t.string.charAt(i)):null;n+=l||r}),{...t,string:n}},Gn=t=>(s,n,e={})=>{const r=S(us(),Ds(),Xs(),Lt(t,e),as(),qs(),Is(t)),i=o=>o.map(r);return S(Ns(t,e),es(),Zt(t,e,n),i,ks(),Us())(s)},Qs=T(),Bn=()=>t=>{const{string:s}=t,n=t.runs[0]?.attributes.direction,{levels:e}=Qs.getEmbeddingLevels(s,n);let r=null,i=0,o=0;const l=[];for(let h=0;h<e.length;h+=1){const a=e[h];a!==r&&(r!==null&&l.push({start:i,end:o,attributes:{bidiLevel:r}}),i=o,r=a),o+=1}return i<s.length&&l.push({start:i,end:s.length,attributes:{bidiLevel:r}}),{string:s,runs:l}},P=1e4,Vs=(t,s,n)=>{let e=null,r=1/0;const i={width:0,stretch:0,shrink:0},o=s[Math.min(n,s.length-1)],l=c=>{const h="stretch"in c?c.stretch:null;if(i.width<o)return h&&i.stretch-h>0?(o-i.width)/i.stretch:P;const a="shrink"in c?c.shrink:null;return i.width>o?a&&i.shrink-a>0?(o-i.width)/i.shrink:P:0};for(let c=0;c<t.length;c+=1){const h=t[c];if(h.type==="box"&&(i.width+=h.width),h.type==="glue"&&(i.width+=h.width,i.stretch+=h.stretch,i.shrink+=h.shrink),i.width-i.shrink>o){if(e===null){let a=c===0?c+1:c;for(;a<t.length&&(t[a].type==="glue"||t[a].type==="penalty");)a++;e=a-1}break}if(h.type==="penalty"||h.type==="glue"){const a=l(h),u=h.type==="penalty"?h.penalty:0,f=100*Math.abs(a)**3+u;r>=f&&(e=c,r=f)}}return i.width-i.shrink>o?e:null},tn=(t,s)=>{let n=0,e=0,r=t;const i=[0];for(;r.length>0;){const o=Vs(r,s,e);o!==null?(n+=o,i.push(n),r=r.slice(o+1,r.length),n++,e++):r=[]}return i};class sn{data;prev;next;constructor(s){this.data=s,this.prev=null,this.next=null}}class C{static Node=sn;head;tail;listSize;listLength;constructor(){this.head=null,this.tail=null,this.listSize=0,this.listLength=0}isLinked(s){return!(s&&s.prev===null&&s.next===null&&this.tail!==s&&this.head!==s||this.isEmpty())}size(){return this.listSize}isEmpty(){return this.listSize===0}first(){return this.head}last(){return this.last}forEach(s){let n=this.head;for(;n!==null;)s(n),n=n.next}at(s){let n=this.head,e=0;if(s>=this.listLength||s<0)return null;for(;n!==null;){if(s===e)return n;n=n.next,e+=1}return null}insertAfter(s,n){return this.isLinked(s)?(n.prev=s,n.next=s.next,s.next===null?this.tail=n:s.next.prev=n,s.next=n,this.listSize+=1,this):this}insertBefore(s,n){return this.isLinked(s)?(n.prev=s.prev,n.next=s,s.prev===null?this.head=n:s.prev.next=n,s.prev=n,this.listSize+=1,this):this}push(s){return this.head===null?this.unshift(s):this.insertAfter(this.tail,s),this}unshift(s){return this.head===null?(this.head=s,this.tail=s,s.prev=null,s.next=null,this.listSize+=1):this.insertBefore(this.head,s),this}remove(s){return this.isLinked(s)?(s.prev===null?this.head=s.next:s.prev.next=s.next,s.next===null?this.tail=s.prev:s.next.prev=s.prev,this.listSize-=1,this):this}}function U(t,s,n,e,r,i){return{position:t,demerits:s,line:n,fitnessClass:e,totals:r||{width:0,stretch:0,shrink:0},previous:i}}function nn(t,s,n,e,r,i){let o=n.width-r.totals.width,l=0,c=0;const h=i<s.length?s[i-1]:s[s.length-1];return t[e].type==="penalty"&&(o+=t[e].width),o<h?(l=n.stretch-r.totals.stretch,l>0?(h-o)/l:g.infinity):o>h?(c=n.shrink-r.totals.shrink,c>0?(h-o)/c:g.infinity):0}function en(t,s,n){const e={width:s.width,stretch:s.stretch,shrink:s.shrink};for(let r=n;r<t.length;r+=1){const i=t[r];if(i.type==="glue")e.width+=i.width,e.stretch+=i.stretch,e.shrink+=i.shrink;else if(i.type==="box"||i.type==="penalty"&&i.penalty===-g.infinity&&r>n)break}return e}function rn(t){const s=[];if(t.size()===0)return[];let n={data:{demerits:1/0}};for(t.forEach(e=>{e.data.demerits<n.data.demerits&&(n=e)});n!==null;)s.push(n.data.position),n=n.data.previous;return s.reverse()}const g=(t,s,n)=>{const e={demerits:{line:10,flagged:100,fitness:3e3},tolerance:n||3},r=new C,i={width:0,stretch:0,shrink:0},o=s;r.push(new C.Node(U(0,0,0,0,void 0,null)));function l(c,h,a){let u=r.first();for(;u!==null;){let f=0;const p=[{active:void 0,demerits:1/0},{active:void 0,demerits:1/0},{active:void 0,demerits:1/0},{active:void 0,demerits:1/0}];for(;u!==null;){f=u.data.line+1;const d=nn(a,o,i,h,u.data,f);if((d<-1||c.type==="penalty"&&c.penalty===-g.infinity)&&r.remove(u),d>=-1&&d<=e.tolerance){const b=100*Math.pow(Math.abs(d),3);let y=0;c.type==="penalty"&&c.penalty>=0?y=Math.pow(e.demerits.line+b,2)+Math.pow(c.penalty,2):c.type==="penalty"&&c.penalty!==-g.infinity?y=Math.pow(e.demerits.line+b,2)-Math.pow(c.penalty,2):y=Math.pow(e.demerits.line+b,2),c.type==="penalty"&&a[u.data.position].type==="penalty"&&(y+=e.demerits.flagged*c.flagged*a[u.data.position].flagged);let x;d<-.5?x=0:d<=.5?x=1:d<=1?x=2:x=3,Math.abs(x-u.data.fitnessClass)>1&&(y+=e.demerits.fitness),y+=u.data.demerits,y<p[x].demerits&&(p[x]={active:u,demerits:y})}if(u=u.next,u!==null&&u.data.line>=f)break}const m=en(a,i,h);for(let d=0;d<p.length;d+=1){const b=p[d];if(b.demerits===1/0)continue;const y=new C.Node(U(h,b.demerits,b.active.data.line+1,d,m,b.active));u!==null?r.insertBefore(u,y):r.push(y)}}}return t.forEach((c,h,a)=>{if(c.type==="box"){i.width+=c.width;return}if(c.type==="glue"){h>0&&a[h-1].type==="box"&&l(c,h,a),i.width+=c.width,i.stretch+=c.stretch,i.shrink+=c.shrink;return}c.type==="penalty"&&c.penalty!==g.infinity&&l(c,h,a)}),rn(r)};g.infinity=1e4;g.glue=(t,s,n,e,r)=>({type:"glue",start:s,end:n,width:t,stretch:e,shrink:r});g.box=(t,s,n,e=!1)=>({type:"box",width:t,start:s,end:n,hyphenated:e});g.penalty=(t,s,n)=>({type:"penalty",width:t,penalty:s,flagged:n});const on=(t,s)=>{const n=s.start+t,e=s.end+t;return Object.assign({},s,{start:n,end:e})},cn=t=>t.end-t.start,ln=(t,s)=>{const n=t.end+cn(s),e=(t.glyphs||[]).concat(s.glyphs||[]),r=(t.positions||[]).concat(s.positions||[]),i=Object.assign({},t.attributes,s.attributes),o=t.glyphIndices||[],l=O(o)||0,c=(s.glyphIndices||[]).map(a=>a+l+1),h=V(o.concat(c));return Object.assign({},t,{end:n,glyphs:e,positions:r,attributes:i,glyphIndices:h})},an=(t,s,n)=>{if(!s)return n;const e=v(0,t,n),r=v(t,1/0,n);return ln(et(s,e),r)},hn=(t,s,n)=>{const e=H(n),r=st(s)?nt(s,e):s;return an(t,r,n)},un=(t,s)=>M(t,s.runs),fn=(t,s,n)=>{const e=un(t,n);if(e===-1)return it(s,n);const r=[s],i=n.string.slice(0,t)+rt(r)+n.string.slice(t),o=n.runs.map((l,c)=>c===e?hn(t-l.start,s,l):c>e?on(r.length,l):l);return Object.assign({},n,{string:i,runs:o})},pn=(t,s,n)=>{const e=n.start||0,r=Math.max(0,E(t-e,n)),i=Math.max(0,E(s-e,n)),o=(n.positions||[]).slice(r,i);return pt(o)},dn=(t,s,n)=>tt(t,s,n.runs).reduce((r,i)=>r+pn(t,s,i),0),gn=45,yn=5,mn=50,R={width:3,stretch:6,shrink:9},bn=(t,s,n)=>{let e=0,r=null;const i=n.reduce((o,l)=>{const c=s[l],h=s[l-1];if(l===s.length-1)return o;let a;return c.type==="penalty"?(r=h.end,a=I(e,r,t),a=fn(a.string.length,gn,a)):(r=c.end,a=I(e,r,t)),e=r,[...o,a]},[]);return i.push(I(e,t.string.length,t)),i},xn=(t,{align:s},n)=>{let e=0;const r=5,{syllables:i}=t,o=n.hyphenationPenalty||(s==="justify"?100:600),l=i.reduce((c,h,a)=>{const u=dn(e,e+h.length,t);if(h.trim()===""){const f=u*R.width/R.stretch,p=u*R.width/R.shrink,m=e+h.length;c.push(g.glue(u,e,m,f,p))}else{const f=i[a+1]!==" ",p=e+h.length;c.push(g.box(u,e,p,f)),i[a+1]&&f&&c.push(g.penalty(r,o,1))}return e+=h.length,c},[]);return l.push(g.glue(0,e,e,g.infinity,0)),l.push(g.penalty(0,-g.infinity,1)),l},On=t=>t.runs?.[0]?.attributes||{},Dn=t=>(s,n)=>{let e=t.tolerance||4;const r=On(s),i=xn(s,r,t);let o=g(i,n,e);for(;o.length===0&&e<mn;)e+=yn,o=g(i,n,e);return(o.length===0||o.length===1&&o[0]===0)&&(o=tn(i,n)),bn(s,i,o.slice(1))};var k;(function(t){t[t.GROW=0]="GROW",t[t.SHRINK=1]="SHRINK"})(k||(k={}));const dt=1,gt=2,In={before:.5,after:.5,priority:dt,unconstrained:!1},kn={before:.14453125,after:.14453125,priority:gt,unconstrained:!1},wn={before:-.04296875,after:-.04296875,priority:dt,unconstrained:!1},vn={before:-.04296875,after:-.04296875,priority:gt,unconstrained:!1},Ln=(t,s)=>{const n=s.expandCharFactor||{},e=s.shrinkCharFactor||{};return t===k.GROW?Object.assign({},kn,n):Object.assign({},vn,e)},Pn=(t,s)=>{const n=s.expandWhitespaceFactor||{},e=s.shrinkWhitespaceFactor||{};return t===k.GROW?Object.assign({},In,n):Object.assign({},wn,e)},Rn=(t,s)=>n=>{const e=Ln(t,s),r=Pn(t,s),i=[];for(let o=0;o<n.length;o+=1){let l;const c=n[o];z(c)?(l=Object.assign({},r),o===n.length-1&&(l.before=0,o>0&&(i[o-1].after=0))):c.isMark&&o>0?(l=Object.assign({},i[o-1]),l.before=0,i[o-1].after=0):l=Object.assign({},e),i.push(l)}return i},jn=(t,s,n)=>{const e=t>0?k.GROW:k.SHRINK,r=Rn(e,n),i=s.runs.reduce((o,l)=>o.concat(r(l.glyphs)),[]);return i[0].before=0,i[i.length-1].after=0,i},X=0,F=3,En=(t,s)=>{let n=0;const e=[],r=[];for(let a=X;a<=F;a+=1)e[a]=r[a]=0;for(let a=0;a<s.length;a+=1){const u=s[a],f=u.before+u.after;n+=f,e[u.priority]+=f,u.unconstrained&&(r[u.priority]+=f)}let i=-1,o=0,l=t,c;for(c=X;c<=F;c+=1){const a=e[c];if(a!==0){if(i===-1&&(i=c,o=a),Math.abs(l)<=Math.abs(a)){e[c]=l/a,r[c]=0,l=0;break}if(e[c]=1,l-=a,r[c]!==0){r[c]=l/r[c],l=0;break}}}for(let a=c+1;a<=F;a+=1)e[a]=0,r[a]=0;l>0&&i>-1&&(e[i]=(o+(t-n))/o);const h=[];for(let a=0;a<s.length;a+=1){const u=s[a],f=s[a+1];let p=u.after*e[u.priority];f&&(p+=f.before*e[f.priority]),u.unconstrained&&(p+=u.after*r[u.priority],f&&(p+=f.before*r[f.priority])),h.push(p)}return h},An=(t,s)=>{let n=0;for(const e of s.runs)for(const r of e.positions)r.xAdvance+=t[n++];return s},Yn=t=>s=>{const n=s.box.width-W(s);if(n===0)return s;const e=jn(n,s,t),r=En(n,e);return An(r,s)},J=t=>{const s=(n,e)=>Math.max(n,A(e));return t.runs.reduce(s,0)},Cn=12,Kn=()=>t=>{let s=t.overflowLeft||0;const n=t.overflowRight||0,e=W(t)-n;t.decorationLines=[];for(let r=0;r<t.runs.length;r+=1){const i=t.runs[r],o=Math.min(e-s,$(i)),l=Math.max(.5,Math.floor(i.attributes.fontSize/Cn));if(i.attributes.underline){const h={rect:{x:s,y:J(t)+l*2,width:o,height:l},opacity:i.attributes.opacity,color:i.attributes.underlineColor||"black",style:i.attributes.underlineStyle||"solid"};t.decorationLines.push(h)}if(i.attributes.strike){const c=J(t)-A(i)/3,a={rect:{x:s,y:c,width:o,height:l},opacity:i.attributes.opacity,color:i.attributes.strikeColor||"black",style:i.attributes.strikeStyle||"solid"};t.decorationLines.push(a)}s+=o}return t},Fn=["Common","Inherited","Unknown"],Un=()=>t=>{const{string:s}=t;let n="Unknown",e=0,r=0;const i=[];if(!s)return ft();for(let l=0;l<s.length;l+=1){const c=s[l],h=c.codePointAt(0),a=Ot.getScript(h);a!==n&&!Fn.includes(a)&&(n!=="Unknown"&&i.push({start:e,end:r,attributes:{script:n}}),e=r,n=a),r+=c.length}return e<s.length&&i.push({start:e,end:s.length,attributes:{script:n}}),{string:s,runs:i}},yt="­",Sn=It(kt),Mn=t=>t.split(yt),j={},Tn=t=>{const s=t.includes(yt)?t:Sn(t);return Mn(s)},Xn=()=>t=>{const s=`_${t}`;return L(t)?[]:(j[s]||(j[s]=Tn(t)),j[s])},Hn=[173],Z=t=>t.attributes.fontSize||12,$n=(t,s,n)=>{const e=[...s,n];for(let r=0;r<e.length;r+=1){const i=e[r];if(!Hn.includes(t)&&i&&i.hasGlyphForCodePoint&&i.hasGlyphForCodePoint(t))return i}return s.at(-1)},Jn=()=>({string:t,runs:s})=>{let n=null,e=null,r=0,i=0;const o=[];for(let l=0;l<s.length;l+=1){const c=s[l];if(t.length===0){o.push({start:0,end:0,attributes:{font:c.attributes.font}});break}const h=t.slice(c.start,c.end);for(let a=0;a<h.length;a+=1){const u=h[a],f=u.codePointAt(0),p=$n(f,c.attributes.font,n),m=Z(c);(p!==n||m!==e||p.unitsPerEm!==n.unitsPerEm)&&(n&&o.push({start:r,end:i,attributes:{font:[n],scale:e/n.unitsPerEm}}),n=p,e=m,r=i),i+=u.length}}if(r<t.length){const l=Z(O(s));o.push({start:r,end:t.length,attributes:{font:[n],scale:l/n.unitsPerEm}})}return{string:t,runs:o}};export{Jn as a,Dn as b,Bn as c,wt as f,Yn as j,Gn as l,Un as s,Kn as t,Xn as w};
