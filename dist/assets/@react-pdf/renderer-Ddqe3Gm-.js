import{q as I}from"../queue-DoAS7tzh.js";import{r as h,j as B}from"../react-CNOZSPzq.js";import{F as U}from"./font-BXXWAYYz.js";import{r as j}from"./render-Cyzxs9UJ.js";import{a as k}from"./pdfkit-7w6jAvzF.js";import{l as $}from"./layout-KvCx2gi5.js";import{u as S}from"./fns-DvmUkUUA.js";import{i as q}from"./reconciler-CEvOrHNi.js";const M=e=>Object.fromEntries(Object.entries(e).filter(o=>{let[,t]=o;return t!==void 0})),X=(e,o)=>{let{style:t,children:r,...s}=o;return{type:e,box:{},style:t||{},props:s||{},children:[]}},Y=e=>({type:"TEXT_INSTANCE",value:e}),b=(e,o)=>{const t=e.type==="TEXT"||e.type==="LINK"||e.type==="TSPAN"||e.type==="NOTE";if(o.type==="TEXT_INSTANCE"&&!t){console.warn(`Invalid '${o.value}' string child outside <Text> component`);return}e.children.push(o)},K=(e,o)=>{e.type==="ROOT"?e.document=o:b(e,o)},Q=(e,o,t)=>{var r;const s=(r=e.children)===null||r===void 0?void 0:r.indexOf(t);s!==void 0&&s!==-1&&o&&e.children.splice(s,0,o)},z=(e,o)=>{var t;const r=(t=e.children)===null||t===void 0?void 0:t.indexOf(o);r!==void 0&&r!==-1&&e.children.splice(r,1)},G=(e,o)=>{var t;const r=(t=e.children)===null||t===void 0?void 0:t.indexOf(o);r!==void 0&&r!==-1&&e.children.splice(r,1)},H=(e,o,t)=>{e.value=t},J=(e,o,t,r,s)=>{const{style:d,...c}=s;e.props=c,e.style=d},V=e=>{let{onChange:o=()=>{}}=e;return q({appendChild:b,appendChildToContainer:K,commitTextUpdate:H,commitUpdate:J,createInstance:X,createTextInstance:Y,insertBefore:Q,removeChild:z,removeChildFromContainer:G,resetAfterCommit:o})},_=new U;let x;const m={},W=e=>{const o=()=>{var n;const i=((n=m.change)===null||n===void 0?void 0:n.slice())||[];for(let a=0;a<i.length;a+=1)i[a]()},t={type:"ROOT",document:null};x=x||V({onChange:o});const r=x.createContainer(t),s=(n,i)=>{x.updateContainer(n,r,null,i)};e&&s(e);const d=async function(n){n===void 0&&(n=!0);const i=t.document.props||{},{pdfVersion:a,language:v,pageLayout:p,pageMode:l,title:D,author:O,subject:R,keyboards:L,creator:P="react-pdf",producer:A="react-pdf",creationDate:E=new Date,modificationDate:N}=i,w=new k({compress:n,pdfVersion:a,lang:v,displayTitle:!0,autoFirstPage:!1,info:M({Title:D,Author:O,Subject:R,Keywords:L,Creator:P,Producer:A,CreationDate:E,ModificationDate:N})});p&&(w._root.data.PageLayout=S(p)),l&&(w._root.data.PageMode=S(l));const C=await $(t.document,_),F=j(w,C);return{layout:C,fileStream:F}},c=function(n){n===void 0&&(n={}),t.document.props.onRender&&t.document.props.onRender(n)};return{on:(n,i)=>{m[n]||(m[n]=[]),m[n].push(i)},container:t,toBlob:async()=>{const n=[],{layout:i,fileStream:a}=await d();return new Promise((v,p)=>{a.on("data",l=>{n.push(l instanceof Uint8Array?l:new Uint8Array(l))}),a.on("end",()=>{try{const l=new Blob(n,{type:"application/pdf"});c({blob:l,_INTERNAL__LAYOUT__DATA_:i}),v(l)}catch(l){p(l)}})})},toBuffer:async()=>{const{layout:n,fileStream:i}=await d();return c({_INTERNAL__LAYOUT__DATA_:n}),i},toString:async()=>{let n="";const{fileStream:i}=await d(!1);return new Promise((a,v)=>{try{i.on("data",p=>{n+=p}),i.on("end",()=>{c(),a(n)})}catch(p){v(p)}})},removeListener:(n,i)=>{if(!m[n])return;const a=m[n].indexOf(i);a>-1&&m[n].splice(a,1)},updateContainer:s}},le=_,de={create:e=>e},Z=function(e){let{document:o}=e===void 0?{}:e;const t=h.useRef(null),[r,s]=h.useState({url:null,blob:null,error:null,loading:!!o});h.useEffect(()=>{const c=I({autostart:!0,concurrency:1}),y=()=>{s(u=>({...u,loading:!0})),c.splice(0,c.length,()=>r.error?Promise.resolve():t.current.toBlob())},f=u=>{console.error(u),s(g=>({...g,loading:!1,error:u}))},T=u=>{s({blob:u,error:null,loading:!1,url:URL.createObjectURL(u)})};return t.current=W(),t.current.on("change",y),o&&t.current.updateContainer(o),c.on("error",f),c.on("success",T),()=>{c.end(),t.current.removeListener("change",y)}},[]),h.useEffect(()=>()=>{r.url&&URL.revokeObjectURL(r.url)},[r.url]);const d=h.useCallback(c=>{t.current.updateContainer(c)},[]);return[r,d]},ee=(e,o)=>{let{fileName:t="document.pdf",document:r,children:s,onClick:d,href:c,...y}=e;const[f,T]=Z();if(h.useEffect(()=>T(r),[r]),!r)return console.warn("You should pass a valid document to PDFDownloadLink"),null;const u=()=>{f&&window.navigator.msSaveBlob&&window.navigator.msSaveBlob(f.blob,t)},g=n=>{u(),typeof d=="function"&&d(n,f)};return B.jsx("a",{href:f.url,download:t,onClick:g,ref:o,...y,children:typeof s=="function"?s(f):s})},ue=h.forwardRef(ee);export{le as F,ue as P,de as S};
